<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>

        <record id="act_account_invoice_2_child_sale_order" model="ir.actions.act_window">
            <field name="name">Quotations and Sales</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="context">{'search_default_holding_invoice_id': active_id}</field>
        </record>

        <record id="act_account_invoice_2_sale_order" model="ir.actions.act_window">
            <field name="name">Quotations and Sales</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="context">{'search_default_invoice_ids': active_id}</field>
        </record>

        <record id="act_account_invoice_2_account_invoice" model="ir.actions.act_window">
            <field name="name">Account Invoice</field>
            <field name="res_model">account.invoice</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,graph</field>
            <field name="context">{'search_default_holding_invoice_id': active_id}</field>
        </record>

        <record id="action_invoice_tree_view1" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="account.invoice_tree"/>
            <field name="act_window_id" ref="act_account_invoice_2_account_invoice"/>
        </record>

        <record id="action_invoice_from_view" model="ir.actions.act_window.view">
            <field eval="2" name="sequence"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="account.invoice_form"/>
            <field name="act_window_id" ref="act_account_invoice_2_account_invoice"/>
        </record>

        <record id="action_queue_child_invoice_job" model="ir.actions.act_window">
            <field name="name">Child Invoice Jobs</field>
            <field name="res_model">queue.job</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'search_default_pending': 1,
                                   'search_default_enqueued': 1,
                                   'search_default_started': 1,
                                   'search_default_failed': 1,
                                   'search_default_done': 1,
                                   'search_default_holding_invoice_id': active_id}</field>
            <field name="view_id" ref="connector.view_queue_job_tree"/>
            <field name="search_view_id" ref="connector.view_queue_job_search"/>
        </record>

        <record id="view_account_invoice_filter" model="ir.ui.view">
            <field name="model">account.invoice</field>
            <field name="inherit_id"
                   ref="account.view_account_invoice_filter"/>
            <field name="arch" type="xml">
                <field name="number" position="after">
                   <field name="holding_invoice_id"/>
                </field>
            </field>
        </record>

        <record id="invoice_form" model="ir.ui.view">
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
                <button name="invoice_open" position="after">
                    <button name="generate_child_invoice"
                            type="object"
                            string="Generate Child Invoice"
                            attrs="{'invisible':['|', '|', '|',('holding_sale_count','=', 0), ('child_invoice_count','!=', 0), ('child_invoice_job_count','!=', 0), ('state', '=', 'draft')]}"/>
                </button>


                <xpath expr="//sheet/field[@name='type']" position="after">
                    <div class="oe_right oe_button_box" name="buttons">
                        <button class="oe_inline oe_stat_button" type="action"
                            name="%(act_account_invoice_2_child_sale_order)d"
                            attrs="{'invisible':[('holding_sale_count','=', 0)]}"
                            icon="fa-strikethrough">
                            <field string="Sales"
                                   name="holding_sale_count"
                                   widget="statinfo"/>
                        </button>
                        <button class="oe_inline oe_stat_button" type="action"
                            name="%(act_account_invoice_2_account_invoice)d"
                            attrs="{'invisible':[('child_invoice_count','=', 0)]}"
                            icon="fa-strikethrough">
                            <field string="Invoice"
                                   name="child_invoice_count"
                                   widget="statinfo"/>
                        </button>
                        <button class="oe_inline oe_stat_button" type="action"
                            name="%(act_account_invoice_2_sale_order)d"
                            attrs="{'invisible':[('sale_count','=', 0)]}"
                            icon="fa-strikethrough">
                            <field string="Sales"
                                   name="sale_count"
                                   widget="statinfo"/>
                        </button>
                        <button class="oe_inline oe_stat_button" type="action"
                            name="%(action_queue_child_invoice_job)d"
                            attrs="{'invisible':[('child_invoice_job_count', '=', 0)]}"
                            icon="fa-strikethrough">
                            <field string="Child Invoice Jobs"
                                   name="child_invoice_job_count"
                                   widget="statinfo"/>
                        </button>
 
                    </div>
                </xpath>
            </field>
        </record>

    </data>
</openerp>
